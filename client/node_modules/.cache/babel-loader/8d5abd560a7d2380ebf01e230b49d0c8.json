{"ast":null,"code":"import _objectSpread from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"F:\\\\mern\\\\projects\\\\greenbeans\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from\"react\";import{useLocation,useParams,useNavigate}from\"react-router-dom\";import{isAuthenticated}from\"../auth\";import{getUserCart,createOrder,getUser,razorPayOrder,paymentVerify,updateOrderConfirmation}from\"../user\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CartPayment=function CartPayment(){var _useParams=useParams(),userId=_useParams.userId;var naviagte=useNavigate();var location=useLocation();var shippingAddress=location.state;var _useState=useState({paymentMode:\"RazorPay\",total:10,userDetails:\"\"}),_useState2=_slicedToArray(_useState,2),values=_useState2[0],setValues=_useState2[1];var cart=[];var order=\"\";var paymentMode=values.paymentMode,total=values.total,userDetails=values.userDetails;var _isAuthenticated=isAuthenticated(),user=_isAuthenticated.user,token=_isAuthenticated.token;var isRadioSelected=function isRadioSelected(value){if(paymentMode===value){return true;}else{return false;}};var preLoadCart=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userId,token){var data,tempTotal;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getUserCart(userId,token);case 3:data=_context.sent;if(data.error){console.log(data.error);}else{cart=data.cart;console.log(cart);tempTotal=0;cart.map(function(cartItem){return tempTotal=tempTotal+cartItem.product.pPrice*cartItem.quantity;});setValues(_objectSpread(_objectSpread({},values),{},{total:tempTotal}));}_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function preLoadCart(_x,_x2){return _ref.apply(this,arguments);};}();var preLoadUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(userId,token){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return getUser(userId,token);case 3:data=_context2.sent;if(!data.error){_context2.next=8;break;}console.log(data.error);_context2.next=9;break;case 8:return _context2.abrupt(\"return\",setValues(_objectSpread(_objectSpread({},values),{},{userDetails:data})));case 9:_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function preLoadUser(_x3,_x4){return _ref2.apply(this,arguments);};}();useEffect(function(){preLoadCart(userId,token);},[]);useEffect(function(){preLoadUser(userId,token);},[]);var handleOrder=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userId,token){var data,_data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return createOrder(userId,token,{shippingAddress:shippingAddress,paymentMode:paymentMode});case 3:data=_context3.sent;if(!data.error){_context3.next=8;break;}console.log(data.error);_context3.next=28;break;case 8:order=data.order;if(!(paymentMode===\"RazorPay\")){_context3.next=14;break;}_context3.next=12;return handlePayment(total);case 12:_context3.next=28;break;case 14:_context3.prev=14;_context3.next=17;return updateOrderConfirmation(userId,token,order._id,{Ostatus:\"Ordered\"});case 17:_data=_context3.sent;if(!_data.error){_context3.next=22;break;}return _context3.abrupt(\"return\",console.log(_data.error));case 22:console.log(_data);naviagte(\"/thankyou/\".concat(order._id));case 24:_context3.next=28;break;case 26:_context3.prev=26;_context3.t0=_context3[\"catch\"](14);case 28:_context3.next=33;break;case 30:_context3.prev=30;_context3.t1=_context3[\"catch\"](0);console.log(_context3.t1);case 33:case\"end\":return _context3.stop();}}},_callee3,null,[[0,30],[14,26]]);}));return function handleOrder(_x5,_x6){return _ref3.apply(this,arguments);};}();var handlePayment=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(total){var data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return razorPayOrder({total:total});case 3:data=_context4.sent;if(!data.error){_context4.next=8;break;}return _context4.abrupt(\"return\",console.log(data.error));case 8:console.log(data);initPayment(data.data);case 10:_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[0,12]]);}));return function handlePayment(_x7){return _ref4.apply(this,arguments);};}();var initPayment=function initPayment(data){var options={key:process.env.RAZORPAY_KEY_SECRET,amount:data.amount,currency:data.currency,name:\"Fruits and Veggies\",order_id:data.id,prefill:{name:userDetails.name,email:userDetails.email,contact:userDetails.phoneNumber},handler:function(){var _handler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(response){var _data2;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return paymentVerify({response:response,order:order});case 3:_data2=_context5.sent;if(!_data2.error){_context5.next=6;break;}return _context5.abrupt(\"return\",console.log(_data2.error));case 6:console.log(_data2);naviagte(\"/thankyou/\".concat(order._id));_context5.next=13;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[0,10]]);}));function handler(_x8){return _handler.apply(this,arguments);}return handler;}(),theme:{color:\"#3399cc\"}};var rzp1=new window.Razorpay(options);rzp1.open();};return/*#__PURE__*/_jsx(\"section\",{className:\"cardPayment-section\",children:/*#__PURE__*/_jsx(\"div\",{className:\"wrap cardPayment-wrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-info-sec\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-sec\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"cardpayment-delivery-details-header\",children:\"Delivery Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cardPayment-delivery-details-single-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"cardPayment-delivery-details-label\",children:\"Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"cardPayment-delivery-details-value\",children:\"name\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-double-group\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"cardPayment-delivery-details-label\",children:\"Email\"}),/*#__PURE__*/_jsx(\"p\",{className:\"cardPayment-delivery-details-value\",children:\"email\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"cardPayment-delivery-details-label\",children:\"Phone\"}),/*#__PURE__*/_jsx(\"p\",{className:\"cardPayment-delivery-details-value\",children:\"phoneNumber\"})]})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"cardPayment-delivery-details-subheader\",children:\"Shipping Address\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-double-group\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"cardPayment-delivery-details-label\",children:\"House Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"cardPayment-delivery-details-value\",children:\"houseName\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-delivery-details-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"cardPayment-delivery-details-label\",children:\"Street Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"cardPayment-delivery-details-value\",children:\"streetName\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-payment-details-sec\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"cardPayment-payment-details-header\",children:\"Payment Mode\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-payment-details-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-payment-details-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"payment_mode\",id:\"RazorPay\",value:\"RazorPay\",checked:isRadioSelected(\"RazorPay\"),onChange:function onChange(e){return setValues(_objectSpread(_objectSpread({},values),{},{paymentMode:e.target.value}));}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"RazorPay\",className:\"cardPayment-payment-details-label\",children:\"Make Payment Online (RazorPay)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cardPayment-payment-details-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"payment_mode\",id:\"CashOnDelivery\",value:\"CashOnDelivery\",checked:isRadioSelected(\"CashOnDelivery\"),onChange:function onChange(e){return setValues(_objectSpread(_objectSpread({},values),{},{paymentMode:e.target.value}));}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"CashOnDelivery\",className:\"cardPayment-payment-details-label\",children:\"Cash On Delivery\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"cardPayment-payment-details-btn\",onClick:function onClick(){return handleOrder(userId,token);},children:\"Make Payment\"})]})]})]})})});};","map":{"version":3,"sources":["F:/mern/projects/greenbeans/client/src/core/CartPayment.js"],"names":["React","useState","useEffect","useLocation","useParams","useNavigate","isAuthenticated","getUserCart","createOrder","getUser","razorPayOrder","paymentVerify","updateOrderConfirmation","CartPayment","userId","naviagte","location","shippingAddress","state","paymentMode","total","userDetails","values","setValues","cart","order","user","token","isRadioSelected","value","preLoadCart","data","error","console","log","tempTotal","map","cartItem","product","pPrice","quantity","preLoadUser","handleOrder","handlePayment","_id","Ostatus","initPayment","options","key","process","env","RAZORPAY_KEY_SECRET","amount","currency","name","order_id","id","prefill","email","contact","phoneNumber","handler","response","theme","color","rzp1","window","Razorpay","open","e","target"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useLocation, useParams, useNavigate } from \"react-router-dom\";\r\nimport { isAuthenticated } from \"../auth\";\r\nimport {\r\n  getUserCart,\r\n  createOrder,\r\n  getUser,\r\n  razorPayOrder,\r\n  paymentVerify,\r\n  updateOrderConfirmation,\r\n} from \"../user\";\r\n\r\nexport const CartPayment = () => {\r\n  const { userId } = useParams();\r\n\r\n  const naviagte = useNavigate();\r\n  const location = useLocation();\r\n  const shippingAddress = location.state;\r\n  const [values, setValues] = useState({\r\n    paymentMode: \"RazorPay\",\r\n    total: 10,\r\n    userDetails: \"\",\r\n  });\r\n\r\n  var cart = [];\r\n  var order = \"\";\r\n\r\n  const { paymentMode, total, userDetails } = values;\r\n\r\n  const { user, token } = isAuthenticated();\r\n\r\n  const isRadioSelected = (value) => {\r\n    if (paymentMode === value) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const preLoadCart = async (userId, token) => {\r\n    try {\r\n      const data = await getUserCart(userId, token);\r\n      if (data.error) {\r\n        console.log(data.error);\r\n      } else {\r\n        cart = data.cart;\r\n        console.log(cart);\r\n        var tempTotal = 0;\r\n        cart.map(\r\n          (cartItem) =>\r\n            (tempTotal =\r\n              tempTotal + cartItem.product.pPrice * cartItem.quantity)\r\n        );\r\n        setValues({ ...values, total: tempTotal });\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const preLoadUser = async (userId, token) => {\r\n    try {\r\n      const data = await getUser(userId, token);\r\n      if (data.error) {\r\n        console.log(data.error);\r\n      } else {\r\n        // return (userDetails = data);\r\n        return setValues({ ...values, userDetails: data });\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    preLoadCart(userId, token);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    preLoadUser(userId, token);\r\n  }, []);\r\n\r\n  const handleOrder = async (userId, token) => {\r\n    try {\r\n      const data = await createOrder(userId, token, {\r\n        shippingAddress,\r\n        paymentMode,\r\n      });\r\n      if (data.error) {\r\n        console.log(data.error);\r\n      } else {\r\n        order = data.order;\r\n        if (paymentMode === \"RazorPay\") {\r\n          await handlePayment(total);\r\n        } else {\r\n          try {\r\n            const data = await updateOrderConfirmation(userId, token, order._id, {\r\n              Ostatus: \"Ordered\",\r\n            });\r\n            if (data.error) {\r\n              return console.log(data.error);\r\n            } else {\r\n              console.log(data);\r\n              naviagte(`/thankyou/${order._id}`);\r\n            }\r\n          } catch (error) {}\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const handlePayment = async (total) => {\r\n    try {\r\n      const data = await razorPayOrder({ total });\r\n      if (data.error) {\r\n        return console.log(data.error);\r\n      } else {\r\n        console.log(data);\r\n        initPayment(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const initPayment = (data) => {\r\n    const options = {\r\n      key: process.env.RAZORPAY_KEY_SECRET,\r\n      amount: data.amount,\r\n      currency: data.currency,\r\n      name: \"Fruits and Veggies\",\r\n      order_id: data.id,\r\n      prefill: {\r\n        name: userDetails.name,\r\n        email: userDetails.email,\r\n        contact: userDetails.phoneNumber,\r\n      },\r\n      handler: async (response) => {\r\n        try {\r\n          const data = await paymentVerify({ response, order });\r\n          if (data.error) {\r\n            return console.log(data.error);\r\n          }\r\n          console.log(data);\r\n          naviagte(`/thankyou/${order._id}`);\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      },\r\n      theme: {\r\n        color: \"#3399cc\",\r\n      },\r\n    };\r\n    const rzp1 = new window.Razorpay(options);\r\n    rzp1.open();\r\n  };\r\n\r\n  return (\r\n    <section className=\"cardPayment-section\">\r\n      <div className=\"wrap cardPayment-wrap\">\r\n        <div className=\"cardPayment-info-sec\">\r\n          <div className=\"cardPayment-delivery-details-sec\">\r\n            <h2 className=\"cardpayment-delivery-details-header\">\r\n              Delivery Details\r\n            </h2>\r\n            <div className=\"cardPayment-delivery-details\">\r\n              <div className=\"cardPayment-delivery-details-single-group\">\r\n                <div className=\"cardPayment-delivery-details-group\">\r\n                  <label className=\"cardPayment-delivery-details-label\">\r\n                    Name\r\n                  </label>\r\n                  <p className=\"cardPayment-delivery-details-value\">name</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"cardPayment-delivery-details-double-group\">\r\n                <div className=\"cardPayment-delivery-details-group\">\r\n                  <label className=\"cardPayment-delivery-details-label\">\r\n                    Email\r\n                  </label>\r\n                  <p className=\"cardPayment-delivery-details-value\">email</p>\r\n                </div>\r\n                <div className=\"cardPayment-delivery-details-group\">\r\n                  <label className=\"cardPayment-delivery-details-label\">\r\n                    Phone\r\n                  </label>\r\n                  <p className=\"cardPayment-delivery-details-value\">\r\n                    phoneNumber\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <h3 className=\"cardPayment-delivery-details-subheader\">\r\n                Shipping Address\r\n              </h3>\r\n              <div className=\"cardPayment-delivery-details-double-group\">\r\n                <div className=\"cardPayment-delivery-details-group\">\r\n                  <label className=\"cardPayment-delivery-details-label\">\r\n                    House Name\r\n                  </label>\r\n                  <p className=\"cardPayment-delivery-details-value\">\r\n                    houseName\r\n                  </p>\r\n                </div>\r\n                <div className=\"cardPayment-delivery-details-group\">\r\n                  <label className=\"cardPayment-delivery-details-label\">\r\n                    Street Name\r\n                  </label>\r\n                  <p className=\"cardPayment-delivery-details-value\">\r\n                    streetName\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"cardPayment-payment-details-sec\">\r\n            <h2 className=\"cardPayment-payment-details-header\">Payment Mode</h2>\r\n            <div className=\"cardPayment-payment-details-form\">\r\n              <div className=\"cardPayment-payment-details-group\">\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"payment_mode\"\r\n                  id=\"RazorPay\"\r\n                  value=\"RazorPay\"\r\n                  checked={isRadioSelected(\"RazorPay\")}\r\n                  onChange={(e) =>\r\n                    setValues({ ...values, paymentMode: e.target.value })\r\n                  }\r\n                />\r\n                <label\r\n                  htmlFor=\"RazorPay\"\r\n                  className=\"cardPayment-payment-details-label\"\r\n                >\r\n                  Make Payment Online (RazorPay)\r\n                </label>\r\n              </div>\r\n\r\n              <div className=\"cardPayment-payment-details-group\">\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"payment_mode\"\r\n                  id=\"CashOnDelivery\"\r\n                  value=\"CashOnDelivery\"\r\n                  checked={isRadioSelected(\"CashOnDelivery\")}\r\n                  onChange={(e) =>\r\n                    setValues({ ...values, paymentMode: e.target.value })\r\n                  }\r\n                />\r\n                <label\r\n                  htmlFor=\"CashOnDelivery\"\r\n                  className=\"cardPayment-payment-details-label\"\r\n                >\r\n                  Cash On Delivery\r\n                </label>\r\n              </div>\r\n              <button\r\n                className=\"cardPayment-payment-details-btn\"\r\n                onClick={() => handleOrder(userId, token)}\r\n              >\r\n                Make Payment\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}