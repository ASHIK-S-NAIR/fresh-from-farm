{"ast":null,"code":"import _defineProperty from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"F:\\\\mern\\\\projects\\\\greenbeans\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect,useContext}from\"react\";import{Link,useParams}from\"react-router-dom\";import{isAuthenticated}from\"../auth\";import{CartContext}from\"../context/Context\";import{deleteFromCart,getUser,getUserCart,// getUserCart,\nupdateFromUserCart}from\"../user\";import CartItem from\"./CartItem\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Cart=function Cart(){var _useContext=useContext(CartContext),cart=_useContext.cart,setCart=_useContext.setCart;// const [cart, setCart] = useState([]);\nvar _useState=useState(0),_useState2=_slicedToArray(_useState,2),subTotal_items=_useState2[0],setSubTotal_items=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),subTotal_value=_useState4[0],setSubTotal_value=_useState4[1];var _useState5=useState(\"default\"),_useState6=_slicedToArray(_useState5,2),shippingAddress_state=_useState6[0],setShippingAddress_state=_useState6[1];var _useState7=useState({shippingAddress_houseName:\" \",shippingAddress_streetName:\" \"}),_useState8=_slicedToArray(_useState7,2),shippingAddress=_useState8[0],setShippingAddress=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),productDetails=_useState10[0],setProductDetails=_useState10[1];var _useParams=useParams(),userId=_useParams.userId;var _isAuthenticated=isAuthenticated(),user=_isAuthenticated.user,token=_isAuthenticated.token;var shippingAddress_houseName=shippingAddress.shippingAddress_houseName,shippingAddress_streetName=shippingAddress.shippingAddress_streetName;var preLoadShippingAddress=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userId,token){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getUser(userId,token);case 3:data=_context.sent;if(!data.error){_context.next=8;break;}console.log(data.error);_context.next=9;break;case 8:return _context.abrupt(\"return\",setShippingAddress(_objectSpread(_objectSpread({},shippingAddress),{},{shippingAddress_houseName:data.address.houseName,shippingAddress_streetName:data.address.streetName})));case 9:_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function preLoadShippingAddress(_x,_x2){return _ref.apply(this,arguments);};}();useEffect(function(){preLoadShippingAddress(userId,token);},[]);var loadSubTotal_value=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var total;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:total=0;cart.map(function(cartItem){return total=total+cartItem.product.pPrice*cartItem.quantity;});return _context2.abrupt(\"return\",setSubTotal_value(total));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function loadSubTotal_value(){return _ref2.apply(this,arguments);};}();useEffect(function(){loadSubTotal_value();},[cart]);useEffect(function(){setSubTotal_items(cart.length);},[cart]);var preLoadCart=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userId,token){var data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getUserCart(userId,token);case 3:data=_context3.sent;return _context3.abrupt(\"return\",setCart(data.cart));case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return function preLoadCart(_x3,_x4){return _ref3.apply(this,arguments);};}();useEffect(function(){console.log(\"reaching here awsome vini\");preLoadCart(userId,token);},[]);var updateQuantity=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(productId,quantity){var data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return updateFromUserCart(userId,token,{productId:productId,quantity:quantity});case 3:data=_context4.sent;if(!data.error){_context4.next=8;break;}console.log(data.error);_context4.next=9;break;case 8:return _context4.abrupt(\"return\",preLoadCart(userId,token));case 9:_context4.next=14;break;case 11:_context4.prev=11;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 14:case\"end\":return _context4.stop();}}},_callee4,null,[[0,11]]);}));return function updateQuantity(_x5,_x6){return _ref4.apply(this,arguments);};}();var deleteProduct=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(productId){var data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return deleteFromCart(userId,token,productId);case 3:data=_context5.sent;if(!data.error){_context5.next=8;break;}return _context5.abrupt(\"return\",console.log(data.error));case 8:return _context5.abrupt(\"return\",preLoadCart(userId,token));case 9:_context5.next=14;break;case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 14:case\"end\":return _context5.stop();}}},_callee5,null,[[0,11]]);}));return function deleteProduct(_x7){return _ref5.apply(this,arguments);};}();var handleChange=function handleChange(name){return function(e){setShippingAddress(_objectSpread(_objectSpread({},shippingAddress),{},_defineProperty({},name,e.target.value)));};};return/*#__PURE__*/_jsx(\"section\",{className:\"cart-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrap cart-wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cart-header-sec\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"cart-header\",children:\"My Cart \"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-subsection\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cartDetail-sec\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cartDetail-sec-hr\"}),cart&&cart.map(function(cartItem,index){return/*#__PURE__*/_jsx(CartItem,{cartItemProductId:cartItem.product._id,cartItemQuantity:cartItem.quantity,updateQuantity:updateQuantity,deleteProduct:deleteProduct},index);}),/*#__PURE__*/_jsx(\"div\",{className:\"cart-subTotal-sec\",children:/*#__PURE__*/_jsxs(\"h2\",{className:\"cart-subTotal-h2\",children:[\"Subtotal (\".concat(subTotal_items,\" items)\"),\" :\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"cart-subTotal-price\",children:\"\".concat(subTotal_value)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-placeOrder-sec\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cart-subTotal-sec cart-placeOrder-subTotal-sec\",children:/*#__PURE__*/_jsxs(\"h2\",{className:\"cart-subTotal-h2\",children:[\"Subtotal (\".concat(subTotal_items,\" items)\"),\" :\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"cart-subTotal-price\",children:\"\".concat(subTotal_value)})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-shippingAddress-sec\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"cart-shippingAddress-header\",children:\"Shipping Address\"}),shippingAddress_state===\"default\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"cart-shippingAddress-default-sec\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cart-shippingAddress-default-address-sec\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"cart-shippingAddress-default-address cart-shippingAddress-default-HouseName\",children:shippingAddress_houseName}),/*#__PURE__*/_jsx(\"p\",{className:\"cart-shippingAddress-default-address cart-shippingAddress-default-StreetName\",children:shippingAddress_streetName})]}),/*#__PURE__*/_jsx(\"button\",{className:\"cart-shippingAddress-edit-btn\",onClick:function onClick(){return setShippingAddress_state(\"edit\");},children:\"Edit\"}),/*#__PURE__*/_jsx(Link,{to:\"/cart/payment/\".concat(userId),state:shippingAddress,children:/*#__PURE__*/_jsx(\"button\",{className:\"cart-shippingAddress-cta-btn\",children:\"Deliver to this Address\"})})]}),shippingAddress_state===\"edit\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"cart-shippingAddress-edit-sec\",children:[/*#__PURE__*/_jsxs(\"form\",{className:\"cart-shippingAddress-edit-address-form\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"cart-shippingAddress-edit-address-default_state\",onClick:function onClick(){return setShippingAddress_state(\"default\");},children:\"Go back to default address\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-shippingAddress-edit-address-sec\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"cart-shippingAddress-edit-address-label\",children:\"House Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"cart-shippingAddress-edit-address-input\",value:shippingAddress_houseName||\" \",onChange:handleChange(\"shippingAddress_houseName\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-shippingAddress-edit-address-sec\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"cart-shippingAddress-edit-address-label\",children:\"Street Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"cart-shippingAddress-edit-address-input\",value:shippingAddress_streetName||\" \",onChange:handleChange(\"shippingAddress_streetName\")})]})]}),/*#__PURE__*/_jsx(Link,{to:\"/cart/payment/\".concat(userId),state:{shippingAddress:shippingAddress},children:/*#__PURE__*/_jsx(\"button\",{className:\"cart-shippingAddress-cta-btn\",children:\"Deliver to this Address\"})})]})]})]})]})]})});};export default Cart;","map":{"version":3,"sources":["F:/mern/projects/greenbeans/client/src/core/Cart.js"],"names":["React","useState","useEffect","useContext","Link","useParams","isAuthenticated","CartContext","deleteFromCart","getUser","getUserCart","updateFromUserCart","CartItem","Cart","cart","setCart","subTotal_items","setSubTotal_items","subTotal_value","setSubTotal_value","shippingAddress_state","setShippingAddress_state","shippingAddress_houseName","shippingAddress_streetName","shippingAddress","setShippingAddress","productDetails","setProductDetails","userId","user","token","preLoadShippingAddress","data","error","console","log","address","houseName","streetName","loadSubTotal_value","total","map","cartItem","product","pPrice","quantity","length","preLoadCart","updateQuantity","productId","deleteProduct","handleChange","name","e","target","value","index","_id"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { Link, useParams } from \"react-router-dom\";\r\nimport { isAuthenticated } from \"../auth\";\r\nimport { CartContext } from \"../context/Context\";\r\nimport {\r\n  deleteFromCart,\r\n  getUser,\r\n  getUserCart,\r\n  // getUserCart,\r\n  updateFromUserCart,\r\n} from \"../user\";\r\nimport CartItem from \"./CartItem\";\r\n\r\nconst Cart = () => {\r\n  const { cart, setCart} = useContext(CartContext);\r\n  // const [cart, setCart] = useState([]);\r\n  const [subTotal_items, setSubTotal_items] = useState(0);\r\n  const [subTotal_value, setSubTotal_value] = useState(0);\r\n  const [shippingAddress_state, setShippingAddress_state] = useState(\"default\");\r\n  const [shippingAddress, setShippingAddress] = useState({\r\n    shippingAddress_houseName: \" \",\r\n    shippingAddress_streetName: \" \",\r\n  });\r\n  const [productDetails, setProductDetails] = useState();\r\n\r\n  const { userId } = useParams();\r\n\r\n  const { user, token } = isAuthenticated();\r\n\r\n  const { shippingAddress_houseName, shippingAddress_streetName } =\r\n    shippingAddress;\r\n\r\n  const preLoadShippingAddress = async (userId, token) => {\r\n    try {\r\n      const data = await getUser(userId, token);\r\n      if (data.error) {\r\n        console.log(data.error);\r\n      } else {\r\n        return setShippingAddress({\r\n          ...shippingAddress,\r\n          shippingAddress_houseName: data.address.houseName,\r\n          shippingAddress_streetName: data.address.streetName,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    preLoadShippingAddress(userId, token);\r\n  }, []);\r\n\r\n  const loadSubTotal_value = async () => {\r\n    var total = 0;\r\n    cart.map((cartItem) => {\r\n      return (total = total + cartItem.product.pPrice * cartItem.quantity);\r\n    });\r\n\r\n    return setSubTotal_value(total);\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadSubTotal_value();\r\n  }, [cart]);\r\n\r\n  useEffect(() => {\r\n    setSubTotal_items(cart.length);\r\n  }, [cart]);\r\n\r\n  const preLoadCart = async (userId, token) => {\r\n    try {\r\n      const data = await getUserCart(userId, token);\r\n      return setCart(data.cart);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    console.log(\"reaching here awsome vini\")\r\n    preLoadCart(userId, token);\r\n  }, []);\r\n\r\n  const updateQuantity = async (productId, quantity) => {\r\n    try {\r\n      const data = await updateFromUserCart(userId, token, {\r\n        productId,\r\n        quantity,\r\n      });\r\n      if (data.error) {\r\n        console.log(data.error);\r\n      } else {\r\n        return preLoadCart(userId, token);\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const deleteProduct = async (productId) => {\r\n    try {\r\n      const data = await deleteFromCart(userId, token, productId);\r\n      if (data.error) {\r\n        return console.log(data.error);\r\n      } else {\r\n        return preLoadCart(userId, token);\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const handleChange = (name) => (e) => {\r\n    setShippingAddress({ ...shippingAddress, [name]: e.target.value });\r\n  };\r\n\r\n  return (\r\n    <section className=\"cart-section\">\r\n      <div className=\"wrap cart-wrap\">\r\n        <div className=\"cart-header-sec\">\r\n          <h1 className=\"cart-header\">My Cart </h1>\r\n        </div>\r\n        <div className=\"cart-subsection\">\r\n          <div className=\"cartDetail-sec\">\r\n            <div className=\"cartDetail-sec-hr\"></div>\r\n            {cart &&\r\n              cart.map((cartItem, index) => {\r\n                return (\r\n                  <CartItem\r\n                    cartItemProductId={cartItem.product._id}\r\n                    cartItemQuantity={cartItem.quantity}\r\n                    key={index}\r\n                    updateQuantity={updateQuantity}\r\n                    deleteProduct={deleteProduct}\r\n                  />\r\n                );\r\n              })}\r\n            <div className=\"cart-subTotal-sec\">\r\n              <h2 className=\"cart-subTotal-h2\">\r\n                {`Subtotal (${subTotal_items} items)`} :{\" \"}\r\n                <span className=\"cart-subTotal-price\">{`${subTotal_value}`}</span>\r\n              </h2>\r\n            </div>\r\n          </div>\r\n          <div className=\"cart-placeOrder-sec\">\r\n            <div className=\"cart-subTotal-sec cart-placeOrder-subTotal-sec\">\r\n              <h2 className=\"cart-subTotal-h2\">\r\n                {`Subtotal (${subTotal_items} items)`} :{\" \"}\r\n                <span className=\"cart-subTotal-price\">{`${subTotal_value}`}</span>\r\n              </h2>\r\n            </div>\r\n            <div className=\"cart-shippingAddress-sec\">\r\n              <h3 className=\"cart-shippingAddress-header\">Shipping Address</h3>\r\n              {shippingAddress_state === \"default\" && (\r\n                <div className=\"cart-shippingAddress-default-sec\">\r\n                  <div className=\"cart-shippingAddress-default-address-sec\">\r\n                    <p className=\"cart-shippingAddress-default-address cart-shippingAddress-default-HouseName\">\r\n                      {shippingAddress_houseName}\r\n                    </p>\r\n                    <p className=\"cart-shippingAddress-default-address cart-shippingAddress-default-StreetName\">\r\n                      {shippingAddress_streetName}\r\n                    </p>\r\n                  </div>\r\n                  <button\r\n                    className=\"cart-shippingAddress-edit-btn\"\r\n                    onClick={() => setShippingAddress_state(\"edit\")}\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                  <Link to={`/cart/payment/${userId}`} state={shippingAddress}>\r\n                    <button className=\"cart-shippingAddress-cta-btn\">\r\n                      Deliver to this Address\r\n                    </button>\r\n                  </Link>\r\n                </div>\r\n              )}\r\n              {shippingAddress_state === \"edit\" && (\r\n                <div className=\"cart-shippingAddress-edit-sec\">\r\n                  <form className=\"cart-shippingAddress-edit-address-form\">\r\n                    <p\r\n                      className=\"cart-shippingAddress-edit-address-default_state\"\r\n                      onClick={() => setShippingAddress_state(\"default\")}\r\n                    >\r\n                      Go back to default address\r\n                    </p>\r\n                    <div className=\"cart-shippingAddress-edit-address-sec\">\r\n                      <p className=\"cart-shippingAddress-edit-address-label\">\r\n                        House Name\r\n                      </p>\r\n                      <input\r\n                        type=\"text\"\r\n                        className=\"cart-shippingAddress-edit-address-input\"\r\n                        value={shippingAddress_houseName || \" \"}\r\n                        onChange={handleChange(\"shippingAddress_houseName\")}\r\n                      />\r\n                    </div>\r\n                    <div className=\"cart-shippingAddress-edit-address-sec\">\r\n                      <p className=\"cart-shippingAddress-edit-address-label\">\r\n                        Street Name\r\n                      </p>\r\n                      <input\r\n                        type=\"text\"\r\n                        className=\"cart-shippingAddress-edit-address-input\"\r\n                        value={shippingAddress_streetName || \" \"}\r\n                        onChange={handleChange(\"shippingAddress_streetName\")}\r\n                      />\r\n                    </div>\r\n                  </form>\r\n                  <Link\r\n                    to={`/cart/payment/${userId}`}\r\n                    state={{ shippingAddress }}\r\n                  >\r\n                    <button className=\"cart-shippingAddress-cta-btn\">\r\n                      Deliver to this Address\r\n                    </button>\r\n                  </Link>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"]},"metadata":{},"sourceType":"module"}