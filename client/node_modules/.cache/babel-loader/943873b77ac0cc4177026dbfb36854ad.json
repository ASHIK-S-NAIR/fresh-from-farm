{"ast":null,"code":"import _asyncToGenerator from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"F:/mern/projects/greenbeans/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"F:\\\\mern\\\\projects\\\\greenbeans\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect,useContext}from\"react\";import{API}from\"../backend\";import{Link,useNavigate,useParams}from\"react-router-dom\";import{getProduct,getAllProducts}from\"./helper/productDetailHelper\";import{isAuthenticated}from\"../auth/index\";import{addToUserCart}from\"../user\";import{CartContext}from\"../context/Context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ProductDetail=function ProductDetail(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),product=_useState2[0],setProduct=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),products=_useState4[0],setProducts=_useState4[1];var _useState5=useState(\"1\"),_useState6=_slicedToArray(_useState5,2),quantity=_useState6[0],setQuantity=_useState6[1];var _isAuthenticated=isAuthenticated(),user=_isAuthenticated.user,token=_isAuthenticated.token;var _useParams=useParams(),productId=_useParams.productId;var navigate=useNavigate();var _useContext=useContext(CartContext),preLoadCart=_useContext.preLoadCart;var loadProduct=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(productId){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getProduct(productId);case 3:data=_context.sent;if(!data.error){_context.next=8;break;}return _context.abrupt(\"return\",console.log(data.error));case 8:return _context.abrupt(\"return\",setProduct(data));case 9:_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",console.log(_context.t0));case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function loadProduct(_x){return _ref.apply(this,arguments);};}();var loadProducts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return getAllProducts(\"all\");case 3:data=_context2.sent;if(!data.error){_context2.next=8;break;}return _context2.abrupt(\"return\",console.log(data.error));case 8:return _context2.abrupt(\"return\",setProducts(data));case 9:_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",console.log(_context2.t0));case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function loadProducts(){return _ref2.apply(this,arguments);};}();var handleAddToCart=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(productId,quantity){var data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;if(!(isAuthenticated()&&user.role===0)){_context3.next=13;break;}_context3.next=4;return addToUserCart(user._id,token,{productId:productId,quantity:quantity});case 4:data=_context3.sent;if(!data.error){_context3.next=9;break;}console.log(data.error);_context3.next=11;break;case 9:preLoadCart(user._id,token);return _context3.abrupt(\"return\",navigate(\"/cart/\".concat(user._id)));case 11:_context3.next=18;break;case 13:if(!isAuthenticated()){_context3.next=17;break;}return _context3.abrupt(\"return\",\"\");case 17:navigate(\"/login\");case 18:_context3.next=23;break;case 20:_context3.prev=20;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 23:case\"end\":return _context3.stop();}}},_callee3,null,[[0,20]]);}));return function handleAddToCart(_x2,_x3){return _ref3.apply(this,arguments);};}();useEffect(function(){loadProduct(productId);},[]);useEffect(function(){loadProducts(productId);},[]);return/*#__PURE__*/_jsxs(\"section\",{className:\"productDetail productDetail-section\",children:[product&&/*#__PURE__*/_jsxs(\"div\",{className:\"wrap productDetail-wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"productDetail-img-sec\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"productDetail-img-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"productDetail-category-sec \".concat(product.pCategory===\"vegetable\"?\"color-green\":\"color-orange\"),children:/*#__PURE__*/_jsx(\"p\",{className:\"productDetail-category\",children:product.pCategory===\"vegetable\"?\"Veg\":\"Fruit\"})}),/*#__PURE__*/_jsx(\"img\",{className:\"productDetail-img\",src:\"\".concat(API,\"/product/photo/\").concat(product.pImg.key),alt:\"\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"productDetail-info\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"productDetail-name\",children:product.pName}),/*#__PURE__*/_jsxs(\"h2\",{className:\"productDetail-price\",children:[\"\\u20B9\",/*#__PURE__*/_jsx(\"span\",{children:product.pPrice+\"/Kg\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"productDetail-description\",children:product.pDescription}),/*#__PURE__*/_jsxs(\"h3\",{className:\"productDetail-stock\",children:[product.pStock,\"kg in stock\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"productDetail-quantity-sec\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"productDetail-quantity-p\",children:\"QTY:\"}),\" \",/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"productDetail-quantity\",onChange:function onChange(e){return setQuantity(e.target.value);},value:quantity}),/*#__PURE__*/_jsx(\"p\",{className:\"productDetail-quantity-p\",children:\"Kg\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"productDetail-btn \".concat(product.pStock===0?\"button-unclickable\":\"\"),onClick:function onClick(){return handleAddToCart(product._id,quantity);},children:\"Add to Cart\"}),product.pStock===0&&/*#__PURE__*/_jsx(\"p\",{className:\"productDetail-OOS\",children:\"Currently Out of Stock\"})]})]}),products&&/*#__PURE__*/_jsx(\"div\",{className:\"wrap products-wrap\",children:products.map(function(product,index){return/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(product._id),children:/*#__PURE__*/_jsxs(\"div\",{className:\"product-sec\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-category-sec \".concat(product.pCategory===\"vegetable\"?\"color-green\":\"color-orange\"),children:/*#__PURE__*/_jsx(\"p\",{className:\"product-category\",children:product.pCategory===\"vegetable\"?\"Veg\":\"Fruit\"})}),/*#__PURE__*/_jsx(\"img\",{className:\"product-img\",src:\"\".concat(API,\"/product/photo/\").concat(product.pImg.key),alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-info\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"product-name\",children:product.pName}),/*#__PURE__*/_jsxs(\"h3\",{className:\"product-stock\",children:[product.pStock,\" Kg in stock\"]}),/*#__PURE__*/_jsxs(\"h1\",{className:\"product-price\",children:[product.pPrice,\"/Kg\"]})]})]})},index);})})]});};export default ProductDetail;","map":{"version":3,"sources":["F:/mern/projects/greenbeans/client/src/core/ProductDetail.js"],"names":["React","useState","useEffect","useContext","API","Link","useNavigate","useParams","getProduct","getAllProducts","isAuthenticated","addToUserCart","CartContext","ProductDetail","product","setProduct","products","setProducts","quantity","setQuantity","user","token","productId","navigate","preLoadCart","loadProduct","data","error","console","log","loadProducts","handleAddToCart","role","_id","pCategory","pImg","key","pName","pPrice","pDescription","pStock","e","target","value","map","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { API } from \"../backend\";\r\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\r\nimport { getProduct, getAllProducts } from \"./helper/productDetailHelper\";\r\nimport { isAuthenticated } from \"../auth/index\";\r\nimport { addToUserCart } from \"../user\";\r\nimport { CartContext } from \"../context/Context\";\r\n\r\nconst ProductDetail = () => {\r\n  const [product, setProduct] = useState();\r\n  const [products, setProducts] = useState([]);\r\n  const [quantity, setQuantity] = useState(\"1\");\r\n\r\n  const { user, token } = isAuthenticated();\r\n\r\n  const { productId } = useParams();\r\n\r\n  const navigate = useNavigate();\r\n\r\n  const { preLoadCart } = useContext(CartContext);\r\n\r\n  const loadProduct = async (productId) => {\r\n    try {\r\n      const data = await getProduct(productId);\r\n      if (data.error) {\r\n        return console.log(data.error);\r\n      } else {\r\n        return setProduct(data);\r\n      }\r\n    } catch (error) {\r\n      return console.log(error);\r\n    }\r\n  };\r\n\r\n  const loadProducts = async () => {\r\n    try {\r\n      const data = await getAllProducts(\"all\");\r\n      if (data.error) {\r\n        return console.log(data.error);\r\n      } else {\r\n        return setProducts(data);\r\n      }\r\n    } catch (error) {\r\n      return console.log(error);\r\n    }\r\n  };\r\n\r\n  const handleAddToCart = async (productId, quantity) => {\r\n    try {\r\n      if (isAuthenticated() && user.role === 0) {\r\n        var data = await addToUserCart(user._id, token, {\r\n          productId,\r\n          quantity,\r\n        });\r\n        if (data.error) {\r\n          console.log(data.error);\r\n        } else {\r\n          preLoadCart(user._id, token);\r\n          return navigate(`/cart/${user._id}`);\r\n        }\r\n      } else if (isAuthenticated()) {\r\n        return \"\";\r\n      } else {\r\n        navigate(\"/login\");\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadProduct(productId);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadProducts(productId);\r\n  }, []);\r\n\r\n  return (\r\n    <section className=\"productDetail productDetail-section\">\r\n      {product && (\r\n        <div className=\"wrap productDetail-wrap\">\r\n          <div className=\"productDetail-img-sec\">\r\n            <div className=\"productDetail-img-container\">\r\n              <div\r\n                className={`productDetail-category-sec ${\r\n                  product.pCategory === \"vegetable\"\r\n                    ? \"color-green\"\r\n                    : \"color-orange\"\r\n                }`}\r\n              >\r\n                <p className=\"productDetail-category\">\r\n                  {product.pCategory === \"vegetable\" ? \"Veg\" : \"Fruit\"}\r\n                </p>\r\n              </div>\r\n              <img\r\n                className=\"productDetail-img\"\r\n                src={`${API}/product/photo/${product.pImg.key}`}\r\n                alt=\"\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"productDetail-info\">\r\n            <h1 className=\"productDetail-name\">{product.pName}</h1>\r\n            <h2 className=\"productDetail-price\">\r\n              â‚¹<span>{product.pPrice + \"/Kg\"}</span>\r\n            </h2>\r\n            <p className=\"productDetail-description\">{product.pDescription}</p>\r\n            <h3 className=\"productDetail-stock\">{product.pStock}kg in stock</h3>\r\n            <div className=\"productDetail-quantity-sec\">\r\n              <p className=\"productDetail-quantity-p\">QTY:</p>{\" \"}\r\n              <input\r\n                type=\"text\"\r\n                className=\"productDetail-quantity\"\r\n                onChange={(e) => setQuantity(e.target.value)}\r\n                value={quantity}\r\n              />\r\n              <p className=\"productDetail-quantity-p\">Kg</p>\r\n            </div>\r\n            <button\r\n              className={`productDetail-btn ${\r\n                product.pStock === 0 ? \"button-unclickable\" : \"\"\r\n              }`}\r\n              onClick={() => handleAddToCart(product._id, quantity)}\r\n            >\r\n              Add to Cart\r\n            </button>\r\n            {product.pStock === 0 && (\r\n              <p className=\"productDetail-OOS\">Currently Out of Stock</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {products && (\r\n        <div className=\"wrap products-wrap\">\r\n          {products.map((product, index) => {\r\n            return (\r\n              <Link to={`/product/${product._id}`} key={index}>\r\n                <div className=\"product-sec\">\r\n                  <div\r\n                    className={`product-category-sec ${\r\n                      product.pCategory === \"vegetable\"\r\n                        ? \"color-green\"\r\n                        : \"color-orange\"\r\n                    }`}\r\n                  >\r\n                    <p className=\"product-category\">\r\n                      {product.pCategory === \"vegetable\" ? \"Veg\" : \"Fruit\"}\r\n                    </p>\r\n                  </div>\r\n                  <img\r\n                    className=\"product-img\"\r\n                    src={`${API}/product/photo/${product.pImg.key}`}\r\n                    alt=\"\"\r\n                  />\r\n                  <div className=\"product-info\">\r\n                    <h2 className=\"product-name\">{product.pName}</h2>\r\n                    <h3 className=\"product-stock\">\r\n                      {product.pStock} Kg in stock\r\n                    </h3>\r\n                    <h1 className=\"product-price\">{product.pPrice}/Kg</h1>\r\n                  </div>\r\n                </div>\r\n              </Link>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default ProductDetail;\r\n"]},"metadata":{},"sourceType":"module"}